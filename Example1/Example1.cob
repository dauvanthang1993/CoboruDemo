000010*>
000020 IDENTIFICATION DIVISION.
000030 PROGRAM-ID.   Example1.
000040 ENVIRONMENT    DIVISION.
000050 CONFIGURATION  SECTION.
000051 INPUT-OUTPUT SECTION.
000052 FILE-CONTROL.
000054 		SELECT PRODUCTFILE ASSIGN TO "INPUT.txt"
000056           ORGANIZATION IS LINE SEQUENTIAL.
000057      SELECT WRITEFILE ASSIGN TO "RESULTS.txt"
000058           ORGANIZATION IS LINE SEQUENTIAL.
000059      SELECT PRODUCTFILE-I ASSIGN TO "PRODUCT.txt"
000060      	 ORGANIZATION IS LINE SEQUENTIAL.
000061      SELECT WORKFILE ASSIGN TO "SWAP.TMP".
000063                
000064 DATA DIVISION.
000065 FILE SECTION.
000067 FD PRODUCTFILE.
000068 01 PRODUCT.
000070		02  PRODUCT-ID       PIC X(4).
000071 		02  PRODUCT-NAME     PIC X(20).
000072 		02  PRODUCT-PRICE    PIC 9(4).
000073 		02  PRODUCT-AMOUNT   PIC 9(3).
000074
000075 FD PRODUCTFILE-I.
000076 01 PRODUCT-I.
000078		02  PRODUCT-ID-I     PIC X(4).
000079 		02  PRODUCT-NAME-I   PIC X(20).
000080 		02  PRODUCT-PRICE-I  PIC 9(4).
000081 		02  PRODUCT-AMOUNT-I PIC 9(3).	
000082 	
000083 SD WORKFILE.
000084 01 PRODUCT-W.
000086		02  PRODUCT-ID-W     PIC X(4).
000087 		02  PRODUCT-NAME-W	 PIC X(20).
000088 		02  PRODUCT-PRICE-W  PIC 9(4).
000089 		02  PRODUCT-AMOUNT-W PIC 9(3).		
000090 		
000091 FD WRITEFILE.		
000092 01 WRITE-RESULT.
000093 		02 	WRITE-STRING PIC X(71).	
000094 		
000095 WORKING-STORAGE SECTION.
000096 01 COST.
000097 		02 COST-PRODUCT PIC 9(9)  VALUE ZERO.
000098 		02 COST-ALL     PIC 9(10) VALUE ZERO.
000099 		02 COST-GROUP   PIC 9(10) VALUE ZERO.
000100 01 COUNT-PRODUCT.
000101 		02 COUNT-ALL    PIC 9(3) VALUE ZERO.
000102 		02 COUNT-ERROR  PIC 9(3) VALUE ZERO.	
000103 		02 COUNT-NORMAL PIC 9(3).
000104 					
000107 01 SUM-PART PIC 9(10) VALUE ZERO.
000108 
000109 01 TEMP-STRING PIC X(40).
000110 01 INIT-CONSTANT-VALUE.
000111 		02 INIT-GROUP                  PIC X(37) VALUE "                          GROUP-COST:".
000112 		02 INIT-ERROR                  PIC X(13) VALUE ">>>>>> ERROR".
000113 		02 INIT-TOTALCOST 		       PIC X(39) VALUE "                           Total cost: ".
000114 		02 INIT-TOTALPRODUCT           PIC X(14) VALUE "PRODUCT TOTAL:".
000115 		02 INIT-TOTALPRODUCT-ERROR     PIC X(15) VALUE "PRODUCT ERROR :".
000116 		02 INIT-TOTALPRODUCT-NORMAL    PIC X(15) VALUE "PRODUCT NORMAL:".
000117 		02 INIT-DISPLAY-PRODUCT-ID     PIC X(4)  VALUE "ID".
000118 		02 INIT-DISPLAY-PRODUCT-NAME   PIC X(20) VALUE "NAME".
000119 		02 INIT-PRODUCT-PRICE          PIC X(5)  VALUE "PRICE".
000120 		02 INIT-PRODUCT-AMOUNT         PIC X(6)  VALUE "AMOUNT".
000121 		02 INIT-PRODUCT-COST           PIC X(12) VALUE " COST".
000123 		02 INIT-END-PROGRAM            PIC X(90) VALUE "               **************             ".
000124 		
000125 01 DISPLAY-VALUE.
000126 	    02 DISPLAY-COST-PRODUCT   PIC z,zzz,zz9 	BLANK WHEN ZERO. 
000127 	    02 DISPLAY-COST-GROUP     PIC zz,zzz,zz9	BLANK WHEN ZERO.
000128 	    02 DISPLAY-COST-ALL       PIC zzz,zzz,zz9   BLANK WHEN ZERO.
000129 	    02 DISPLAY-PRODUCT-PRICE  PIC z,zz9 	    BLANK WHEN ZERO.
000130 	    02 DISPLAY-PRODUCT-AMOUNT PIC z,zz9 	    BLANK WHEN ZERO.
000131 01 CHECK.
000132 		02 CHECK-GROUP            PIC X.
000133 		02 CHECK-EOF	  PIC X VALUE "F".	
000134 PROCEDURE DIVISION.
000135 MAIN-PROGRAM.
000136 		PERFORM SORT-FILE
000137 		PERFORM INIT-PROGRAM
000138 		PERFORM MAIN-PROCESS UNTIL CHECK-EOF = "T"
000139 		PERFORM DISPLAY-RESULT
000140		STOP RUN.
000141 INIT-PROGRAM.
000142 		OPEN INPUT PRODUCTFILE
000143      OPEN OUTPUT WRITEFILE
000144 		STRING INIT-DISPLAY-PRODUCT-ID DELIMITED BY SIZE
000145  		   '  '   DELIMITED BY SIZE
000146			   INIT-DISPLAY-PRODUCT-NAME DELIMITED BY SIZE
000147			   '  '   DELIMITED BY SIZE
000148			   INIT-PRODUCT-PRICE DELIMITED BY SIZE
000149			   '  '   DELIMITED BY SIZE
000150			   INIT-PRODUCT-AMOUNT DELIMITED BY SIZE
000151			   '  '   DELIMITED BY SIZE
000152			   INIT-PRODUCT-COST DELIMITED BY SIZE
000153			   INTO WRITE-STRING
000154	    END-STRING	
000155	    DISPLAY WRITE-STRING
000156	    WRITE WRITE-RESULT
000157	    
000158      READ PRODUCTFILE
000159         AT END MOVE "T" TO CHECK-EOF
000160      END-READ.
000161 
000162 MAIN-PROCESS.
000165      ADD 1 TO COUNT-ALL
000167	    IF COUNT-ALL = 1	 THEN
000168	       MOVE PRODUCT-ID(1:1) TO CHECK-GROUP	
000169	    END-IF 
000170	   
000171	    IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000172	       MULTIPLY PRODUCT-PRICE BY PRODUCT-AMOUNT GIVING COST-PRODUCT
000173	       
000174	       IF CHECK-GROUP = PRODUCT-ID(1:1) THEN
000175	           ADD COST-PRODUCT TO COST-GROUP
000176	       ELSE	
000177	       	   PERFORM DISPLAY-GROUP-PRODUCT
000178	       	   WRITE WRITE-RESULT
000179	       	   ADD COST-GROUP TO COST-ALL
000180	           MOVE PRODUCT-ID(1:1) TO CHECK-GROUP
000181	           MOVE COST-PRODUCT TO COST-GROUP
000182	       END-IF
000183	       MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000184    	   PERFORM DISPLAY-CORRECT-PRODUCT
000185    	   WRITE WRITE-RESULT
000186    	   
000187	    ELSE
000188	   	   ADD 1 TO COUNT-ERROR
000189	   	   IF CHECK-GROUP NOT EQUAL PRODUCT-ID(1:1) THEN
000191	   	       PERFORM DISPLAY-GROUP-PRODUCT
000192	   	       WRITE WRITE-RESULT
000193	   	       WRITE WRITE-RESULT
000194	   	       ADD COST-GROUP TO COST-ALL
000195	   	       MOVE PRODUCT-ID(1:1) TO CHECK-GROUP
000196	   	       MOVE 0 TO COST-GROUP
000197	   	       
000198	   	   END-IF
000199	       PERFORM DISPLAY-ERROR-PRODUCT
000200	       WRITE WRITE-RESULT
000201	    END-IF	
000202     
000203      READ PRODUCTFILE
000204         AT END 
000205            MOVE "T" TO CHECK-EOF
000206            PERFORM DISPLAY-GROUP-PRODUCT
000207            WRITE WRITE-RESULT
000208            ADD COST-GROUP TO COST-ALL
000209      END-READ.
000210 
000211 SORT-FILE.
000212 		SORT WORKFILE ON ASCENDING KEY PRODUCT-ID-W
000213   	USING PRODUCTFILE-I GIVING PRODUCTFILE.
000214 
000215* DISPLAY - FUCTION     
000216 DISPLAY-GROUP-PRODUCT.
000217 		MOVE " " TO WRITE-STRING	
000218 		MOVE COST-GROUP TO DISPLAY-COST-GROUP
000219 		STRING INIT-GROUP DELIMITED BY SIZE
000220					CHECK-GROUP DELIMITED BY SPACE
000221					"   "   DELIMITED BY SIZE
000222					DISPLAY-COST-GROUP DELIMITED BY SIZE
000223					INTO WRITE-STRING
000224			   END-STRING
000225 	    DISPLAY WRITE-STRING. 
000226 DISPLAY-ERROR-PRODUCT.
000227		MOVE " " TO WRITE-STRING	
000228  	STRING PRODUCT-ID DELIMITED BY SIZE
000229  		   "  "   DELIMITED BY SIZE
000230			   PRODUCT-NAME DELIMITED BY SIZE
000231			   INIT-ERROR DELIMITED BY SIZE
000232			   INTO WRITE-STRING
000233	    END-STRING
000234	    DISPLAY WRITE-STRING.	    
000236 	     
000237 DISPLAY-CORRECT-PRODUCT.
000238 	   MOVE " " TO WRITE-STRING	
000239 	   MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000240 	   MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000241 	   MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000242     STRING PRODUCT-ID DELIMITED BY SIZE
000243  		   "  "   DELIMITED BY SIZE
000244			   PRODUCT-NAME DELIMITED BY SIZE
000245			   "  "   DELIMITED BY SIZE
000246			   DISPLAY-PRODUCT-PRICE DELIMITED BY SIZE
000247			   "  "   DELIMITED BY SIZE
000248			   DISPLAY-PRODUCT-AMOUNT DELIMITED BY SIZE
000249			   "  "   DELIMITED BY SIZE
000250			   DISPLAY-COST-PRODUCT DELIMITED BY SIZE
000251			   INTO WRITE-STRING
000252	    END-STRING	
000253	    DISPLAY WRITE-STRING.    
000254 DISPLAY-TOTALCOST-PRODUCT.
000255 	   MOVE " " TO WRITE-STRING	
000256 	   MOVE COST-ALL TO DISPLAY-COST-ALL
000257     STRING INIT-TOTALCOST DELIMITED BY SIZE
000258     		  "  "   DELIMITED BY SIZE	
000259  		  DISPLAY-COST-ALL DELIMITED BY SIZE
000260			  INTO WRITE-STRING
000261	    END-STRING	    
000262 	    DISPLAY WRITE-STRING. 
000263 DISPLAY-TOTAL-PRODUCT.
000264 	   MOVE " " TO WRITE-STRING	
000265     STRING INIT-TOTALPRODUCT DELIMITED BY SIZE
000266  		  COUNT-ALL DELIMITED BY SIZE
000267			  INTO WRITE-STRING
000268	    END-STRING	    
000269 	    DISPLAY WRITE-STRING.   
000270 	    
000271 DISPLAY-TOTAL-ERROR-PRODUCT.
000272 	   MOVE " " TO WRITE-STRING	
000273     STRING INIT-TOTALPRODUCT-ERROR DELIMITED BY SIZE
000274  		  COUNT-ERROR DELIMITED BY SIZE
000275			  INTO WRITE-STRING
000276	    END-STRING	    
000277 	    DISPLAY WRITE-STRING.
000278 DISPLAY-TOTAL-NORMAL-PRODUCT.
000279 	   MOVE " " TO WRITE-STRING	
000280 	   SUBTRACT COUNT-ERROR FROM COUNT-ALL GIVING COUNT-NORMAL.
000281     STRING INIT-TOTALPRODUCT-NORMAL DELIMITED BY SIZE
000282  		  COUNT-NORMAL DELIMITED BY SIZE
000283			  INTO WRITE-STRING
000284	    END-STRING	    
000285 	    DISPLAY WRITE-STRING.	    
000286 	    
000287 	    	    
000288 DISPLAY-RESULT.
000291 	   PERFORM DISPLAY-TOTALCOST-PRODUCT
000292 	   WRITE WRITE-RESULT
000293 	   PERFORM DISPLAY-TOTAL-PRODUCT
000294 	   WRITE WRITE-RESULT
000295 	   PERFORM DISPLAY-TOTAL-ERROR-PRODUCT
000296 	   WRITE WRITE-RESULT
000297 	   PERFORM DISPLAY-TOTAL-NORMAL-PRODUCT
000298 	   WRITE WRITE-RESULT
000299 	   DISPLAY INIT-END-PROGRAM
000300 	   MOVE INIT-END-PROGRAM TO WRITE-STRING
000301 	   WRITE WRITE-RESULT
000302 	   CLOSE WRITEFILE.
000303     CLOSE PRODUCTFILE.
000304 
000307 	   
000308 END PROGRAM Example1.