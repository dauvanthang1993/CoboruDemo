000010*>
000020 IDENTIFICATION DIVISION.
000030 PROGRAM-ID.   Example1.
000040 ENVIRONMENT    DIVISION.
000050 CONFIGURATION  SECTION.
000051 INPUT-OUTPUT SECTION.
000052 FILE-CONTROL.
000054 		SELECT PRODUCTFILE ASSIGN TO "INPUT.txt"
000056           ORGANIZATION IS LINE SEQUENTIAL.
000057      SELECT WRITEFILE ASSIGN TO PRINTER.
000059      SELECT SPFILE ASSIGN TO "PRODUCT.txt"
000060      	 ORGANIZATION IS LINE SEQUENTIAL.
000061      SELECT WORKFILE ASSIGN TO "SWAP.TMP".
000063                
000064 DATA DIVISION.
000065 FILE SECTION.
000066*******売上データファイル************ 
000067 FD PRODUCTFILE.
000068 01 PRODUCT.
000070		02  PRODUCT-ID       PIC X(4).
000071 		02  PRODUCT-NAME     PIC X(20).
000072 		02  PRODUCT-PRICE    PIC 9(4).
000073 		02  PRODUCT-AMOUNT   PIC 9(3).
000074* 		
000075******ソートファイルするために********
000076 FD SPFILE.
000077 01 S-PRODUCT.
000078		02  SP-ID     PIC X(4).
000079 		02  SP-NAME   PIC X(20).
000080 		02  SP-PRICE  PIC 9(4).
000081 		02  SP-AMOUNT PIC 9(3).	
000082 	
000083 SD WORKFILE.
000084 01 PRODUCT-W.
000086		02  WP-ID     PIC X(4).
000087 		02  WP-NAME	  PIC X(20).
000088 		02  WP-PRICE  PIC 9(4).
000089 		02  WP-AMOUNT PIC 9(3).	
000090* 			
000091****売上報告書出力ファイル******** 		
000092 FD WRITEFILE.		
000093 01 WRITEP.
000094 		02 	WRITE-STRING PIC X(71).	
000095* 		
000096 WORKING-STORAGE SECTION.
000097 01 COST.
000098 		02 COST-PRODUCT PIC 9(9)  VALUE ZERO.
000099 		02 COST-ALL     PIC 9(10) VALUE ZERO.
000100 		02 COST-GROUP   PIC 9(10) VALUE ZERO.
000101 01 COUNT-PRODUCT.
000102 		02 COUNT-ALL    PIC 9(3) VALUE ZERO.
000103 		02 COUNT-ERROR  PIC 9(3) VALUE ZERO.	
000104 		02 COUNT-NORMAL PIC 9(3).
000105 		02 COUNT-RECORD PIC 9(2) VALUE ZERO.
000106
000107* 01 DISPLAY-TITLE
000108 							
000109*********商品のタイトルを作ります************* 
000110 01 TITLEP.
000120 		02							   PIC X(5)  VALUE SPACE.	
000122 		02                             PIC X(2)  VALUE "ID".
000123 		02                             PIC X(4)  VALUE SPACE.
000124 		02                             PIC X(4)  VALUE "NAME".
000125 		02                             PIC X(18) VALUE SPACE.
000126 		02                             PIC X(5)  VALUE "PRICE".
000127 		02							   PIC X(3)  VALUE SPACE.	
000128 		02                             PIC X(6)  VALUE "AMOUNT".
000129 		02                             PIC X(1)  VALUE SPACE.
000130 		02                             PIC X(4)  VALUE "COST". 
000131* 
000132*****売上報告書のタイトル***********
000133 01 TITLE-SALEREPORT.
000134		02 							   PIC X(13).
000135		02                             PIC X(37)  VALUE "***********  SALE REPORT  ***********".
000137 01 DISPLAY-PRODUCT.
000138 		02						  PIC X(5)  VALUE SPACE.
000139  	02 DISPLAY-PID			  PIC X(4).
000140  	02						  PIC X(2) VALUE SPACE.
000141  	02 DISPLAY-PNAME		  PIC X(20).
000142  	02						  PIC X(2) VALUE SPACE.
000143  	02 DISPLAY-PPRICE		  PIC X(5).
000144  	02 						  PIC X(3) VALUE SPACE.
000145  	02 DISPLAY-PAMOUNT		  PIC X(3).
000146  	02 						  PIC X(2) VALUE SPACE.
000147  	02 DISPLAY-PCOST          PIC X(9).	
000148*  			
000149********グループの商品を指示するために******** 
000150 01 DISPLAY-GROUP.
000151 		02						  PIC X(5)          VALUE SPACE.
000152 		02  					  PIC X(26) 		VALUE SPACE.
000153 		02 						  PIC X(11) 		VALUE "GROUP-COST:".
000154 		02 CHECK-GROUP			  PIC X.	
000155 		02                        PIC X(2)          VALUE SPACE.
000156 		02 DISPLAY-COST-GROUP     PIC zz,zzz,zz9	BLANK WHEN ZERO. 
000157* 		             			
000158 01 DISPLAY-VALUE.
000159 	    02 DISPLAY-COST-PRODUCT   PIC z,zzz,zz9 	BLANK WHEN ZERO. 
000160 	    02 DISPLAY-PRODUCT-PRICE  PIC z,zz9 	    BLANK WHEN ZERO.
000161 	    02 DISPLAY-PRODUCT-AMOUNT PIC zz9 	    BLANK WHEN ZERO.
000162********トータル売上を指示するために********* 	    
000163 01 DISPLAY-TOTAL-COST.
000164 		02                        PIC X             VALUE SPACE.
000165 		02 		    			  PIC X(11) 		VALUE "TOTAL COST:".
000166 		02						  PIC X(1)			VALUE SPACE.	
000167 		02 DISPLAY-COST-ALL       PIC zzz,zzz,zz9   BLANK WHEN ZERO.
000168* 		
000169*******商品の数量を指示するために********** 
000170 01 DISPLAY-TOTALP.
000171 		02                        PIC X             VALUE SPACE.
000172 		02 			              PIC X(14) 		VALUE "PRODUCT TOTAL:".	
000173 		02 						  PIC X     		VALUE SPACE.
000174 		02 DISPLAY-COUNT-ALLP	  PIC z,zz9			BLANK WHEN ZERO.
000175* 		
000176**********正しい商品の数量を指示するために********** 		
000177 01 DISPLAY-TOTALN.
000178 		02                        PIC X             VALUE SPACE.
000179 		02 					      PIC X(15) VALUE "PRODUCT NORMAL:".
000180 		02 DISPLAY-COUNT-NORMALP  PIC z,zz9         BLANK WHEN ZERO.
000181* 		
000182*****商品のエラーの数量を指示するために**********
000183 01 DISPLAY-TOTALE.
000184 		02                        PIC X             VALUE SPACE.
000185 		02 					      PIC X(14) VALUE "PRODUCT ERROR:".
000186 		02                        PIC X				VALUE SPACE.
000187 		02 DISPLAY-COUNT-ERRORP  PIC z,zz9         BLANK WHEN ZERO.		
000188* 						    						  		
000189 01 CHECK.
000190 		02 CHECK-EOF	  		  PIC X VALUE "F".	
000191 PROCEDURE DIVISION.
000192 MAIN-PROGRAM.
000193 		PERFORM SORT-FILE
000194 		PERFORM INIT-PROGRAM
000195 		PERFORM MAIN-PROCESS UNTIL CHECK-EOF = "T"
000196 		PERFORM END-PROGRAM
000197		STOP RUN.
000198 END-MAIN-PROGRAM.		
000199**********************		
000200 INIT-PROGRAM.
000201 		OPEN INPUT PRODUCTFILE
000202      OPEN OUTPUT WRITEFILE
000203      WRITE WRITEP FROM TITLE-SALEREPORT AFTER 5 LINE.
000204	    WRITE WRITEP FROM TITLEP AFTER 3 LINE.
000205      PERFORM PRODUCT-INPUT.
000206 END-INIT-PROGRAM.
000207*      
000209*******主要の処理のプログラム********	 
000210 MAIN-PROCESS.
000214	    MOVE PRODUCT-ID(1:1) TO CHECK-GROUP	
000215	    MOVE 0 TO COST-GROUP
000217	    PERFORM UNTIL PRODUCT-ID(1:1) NOT = CHECK-GROUP OR CHECK-EOF = "T" 
000227	   		IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000228	   		    COMPUTE COST-PRODUCT = PRODUCT-AMOUNT * PRODUCT-PRICE
000229	   		    COMPUTE COST-GROUP = COST-GROUP + COST-PRODUCT
000230	   		ELSE
000231	   		    COMPUTE COUNT-ERROR = COUNT-ERROR + 1
000232	   		END-IF	
000233	   		PERFORM WRITE-PRODUCT
000234	   		COMPUTE COUNT-ALL = COUNT-ALL + 1
000235	   		COMPUTE COUNT-RECORD = COUNT-RECORD + 1
000236	   		PERFORM PRODUCT-INPUT	
000237	    END-PERFORM
000238	    COMPUTE COST-ALL = COST-GROUP + COST-ALL
000239	    PERFORM WRITE-GROUP-PRODUCT.
000266 END-MAIN-PROCESS.
000267*      
000268*****       PRODUCT-ID　のどおりPRODUCT　ファイルをソートします　********
000269 SORT-FILE.
000270 		SORT WORKFILE ON ASCENDING KEY WP-ID
000271   	USING SPFILE GIVING PRODUCTFILE.
000272 END-SORT-FILE.
000273*   	
000274****売上データの入力******* 
000275 PRODUCT-INPUT.
000276		 READ PRODUCTFILE
000277		         AT END 
000278		         	MOVE "T" TO CHECK-EOF
000279		 END-READ.
000280 END-PRODUCT-INPUT.
000281* 		 		
000282******グループのトータル売上を書きます***** 		  
000283 WRITE-GROUP-PRODUCT.
000284 		MOVE COST-GROUP TO DISPLAY-COST-GROUP
000285 	    WRITE WRITEP FROM DISPLAY-GROUP AFTER 2 LINE.   
000286 END-WRITE-GROUP-PRODCUT.
000287* 	      
000288******商品の詳細を書きます****** 	     
000289 WRITE-PRODUCT.
000290	   MOVE PRODUCT-ID     TO DISPLAY-PID
000291	   MOVE PRODUCT-NAME   TO DISPLAY-PNAME
000292	   IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000293	   		MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000294	        MOVE DISPLAY-PRODUCT-PRICE TO DISPLAY-PPRICE 
000295	        MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000296	        MOVE DISPLAY-PRODUCT-AMOUNT TO DISPLAY-PAMOUNT
000297 	   		MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000298 	   		MOVE DISPLAY-COST-PRODUCT TO DISPLAY-PCOST
000299	   ELSE
000300	       IF PRODUCT-PRICE IS NUMERIC THEN
000301	           MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000302	           MOVE DISPLAY-PRODUCT-PRICE TO DISPLAY-PPRICE
000303	       ELSE
000304	           MOVE "-----" TO DISPLAY-PPRICE 
000305	       END-IF
000306	       
000307	       IF PRODUCT-AMOUNT IS NUMERIC THEN
000308	           MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000309	           MOVE DISPLAY-PRODUCT-AMOUNT TO DISPLAY-PAMOUNT
000310	       ELSE
000311	           MOVE "---" TO DISPLAY-PAMOUNT
000312	       END-IF
000313	       
000314	       MOVE "  -------" TO DISPLAY-PCOST
000315	   END-IF
000316   
000317	   PERFORM WRITE-NEXT-PAGE.
000318	   WRITE WRITEP FROM DISPLAY-PRODUCT AFTER 2 LINE.
000319 END-WRITE-PRODUCT.
000320*     
000321*****リコードの数量＞２０のとき新しいページを移動します*******************	
000322 WRITE-NEXT-PAGE.
000323 		IF COUNT-RECORD > 10 THEN
000324	       MOVE 0 TO COUNT-RECORD
000325	       MOVE SPACE TO WRITEP 
000326	       WRITE WRITEP AFTER PAGE
000327	       WRITE WRITEP FROM TITLE-SALEREPORT AFTER 4 LINE
000328	       WRITE WRITEP FROM TITLEP AFTER 3 LINE
000329	   END-IF.
000330 END-WRITE-NEXT-PAGEG.   
000331*	   
000332********トータル売上を書きます*********	     
000333 WRITE-TOTAL-COSTP.
000334 	   MOVE COST-ALL TO DISPLAY-COST-ALL	    
000335 	   WRITE WRITEP FROM DISPLAY-TOTAL-COST. 
000336 END-WRITE-TOTAL-COSTP.
000337* 	   
000338*********商品の数量を書きます************* 
000339 WRITE-TOTALP.
000340	   MOVE COUNT-ALL TO DISPLAY-COUNT-ALLP 
000341 	   WRITE WRITEP FROM DISPLAY-TOTALP.  
000342 END-WRITE-TOTALP.
000343* 	    
000344* ********商品のエラーの数量を書きます*********	    
000345 WRITE-TOTAL-ERRORP.
000346     MOVE COUNT-ERROR TO DISPLAY-COUNT-ERRORP	    
000347 	   WRITE WRITEP FROM DISPLAY-TOTALE.
000348 END-WRITE-TOTAL-ERRORP.
000349* 	   
000350*********正しい商品の数量を書きます************* 	   
000351 WRITE-TOTAL-NORMALP.
000352 	   COMPUTE COUNT-NORMAL = COUNT-ALL - COUNT-ERROR
000353     MOVE COUNT-NORMAL TO DISPLAY-COUNT-NORMALP   
000354 	   WRITE WRITEP FROM DISPLAY-TOTALN.	    
000355 END-WRITE-TOTAL-NORMALP.
000356* 	    
000357********************************* 	    	    
000358 END-PROGRAM.
000361 	   PERFORM WRITE-TOTAL-COSTP
000362 	   PERFORM WRITE-TOTALP
000363 	   PERFORM WRITE-TOTAL-ERRORP
000364 	   PERFORM WRITE-TOTAL-NORMALP
000365 	   CLOSE WRITEFILE.
000366     CLOSE PRODUCTFILE.
000367 END-END-PROGRAM.
000368 	   
000373 END PROGRAM Example1.