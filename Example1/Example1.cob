000010*>
000020 IDENTIFICATION DIVISION.
000030 PROGRAM-ID.   Example1.
000040 ENVIRONMENT    DIVISION.
000050 CONFIGURATION  SECTION.
000051 INPUT-OUTPUT SECTION.
000052 FILE-CONTROL.
000054 		SELECT PRODUCTFILE ASSIGN TO "INPUT.txt"
000056           ORGANIZATION IS LINE SEQUENTIAL.
000057      SELECT WRITEFILE ASSIGN TO PRINTER.
000059      SELECT SPFILE ASSIGN TO "PRODUCT.txt"
000060      	 ORGANIZATION IS LINE SEQUENTIAL.
000061      SELECT WORKFILE ASSIGN TO "SWAP.TMP".
000063                
000064 DATA DIVISION.
000065 FILE SECTION.
000066*******売上データファイル************ 
000067 FD PRODUCTFILE.
000068 01 PRODUCT.
000070		02  PRODUCT-ID       PIC X(4).
000071 		02  PRODUCT-NAME     PIC X(20).
000072 		02  PRODUCT-PRICE    PIC 9(4).
000073 		02  PRODUCT-AMOUNT   PIC 9(3).
000074******ソートファイルするために********
000075 FD SPFILE.
000076 01 S-PRODUCT.
000078		02  SP-ID     PIC X(4).
000079 		02  SP-NAME   PIC X(20).
000080 		02  SP-PRICE  PIC 9(4).
000081 		02  SP-AMOUNT PIC 9(3).	
000082 	
000083 SD WORKFILE.
000084 01 PRODUCT-W.
000086		02  WP-ID     PIC X(4).
000087 		02  WP-NAME	  PIC X(20).
000088 		02  WP-PRICE  PIC 9(4).
000089 		02  WP-AMOUNT PIC 9(3).		
000090****売上報告書出力ファイル******** 		
000091 FD WRITEFILE.		
000092 01 WRITEP.
000093 		02 	WRITE-STRING PIC X(71).	
000094 		
000095 WORKING-STORAGE SECTION.
000096 01 COST.
000097 		02 COST-PRODUCT PIC 9(9)  VALUE ZERO.
000098 		02 COST-ALL     PIC 9(10) VALUE ZERO.
000099 		02 COST-GROUP   PIC 9(10) VALUE ZERO.
000100 01 COUNT-PRODUCT.
000101 		02 COUNT-ALL    PIC 9(3) VALUE ZERO.
000102 		02 COUNT-ERROR  PIC 9(3) VALUE ZERO.	
000103 		02 COUNT-NORMAL PIC 9(3).
000104 		02 COUNT-RECORD PIC 9(2) VALUE ZERO.
000105 					
000108*********タイトルを作ります************* 
000110 01 DISPLAY-TITLEP.
000122 		02                             PIC X(2)  VALUE "ID".
000123 		02                             PIC X(4)  VALUE SPACE.
000124 		02                             PIC X(4)  VALUE "NAME".
000125 		02                             PIC X(18) VALUE SPACE.
000126 		02                             PIC X(5)  VALUE "PRICE".
000127 		02							   PIC X(3)  VALUE SPACE.	
000128 		02                             PIC X(6)  VALUE "AMOUNT".
000129 		02                             PIC X(1)  VALUE SPACE.
000130 		02                             PIC X(4)  VALUE "COST". 
000131*********売上明細編集レコード*************  		   
000132 01 DISPLAY-PRODUCT.
000133  	02 DISPLAY-PID			  PIC X(4).
000134  	02						  PIC X(2) VALUE SPACE.
000135  	02 DISPLAY-PNAME		  PIC X(20).
000136  	02						  PIC X(2) VALUE SPACE.
000137  	02 DISPLAY-PPRICE		  PIC X(5).
000138  	02 						  PIC X(3) VALUE SPACE.
000139  	02 DISPLAY-PAMOUNT		  PIC X(3).
000140  	02 						  PIC X(2) VALUE SPACE.
000141  	02 DISPLAY-PCOST          PIC X(9).			
000142  	
000143********グループの商品を指示するために******** 
000144 01 DISPLAY-GROUP.
000145 		02  					  PIC X(26) 		VALUE SPACE.
000146 		02 						  PIC X(11) 		VALUE "GROUP-COST:".
000147 		02 CHECK-GROUP			  PIC X.	
000148 		02                        PIC X(2)          VALUE SPACE.
000149 		02 DISPLAY-COST-GROUP     PIC zz,zzz,zz9	BLANK WHEN ZERO.              			
000150 01 DISPLAY-VALUE.
000151 	    02 DISPLAY-COST-PRODUCT   PIC z,zzz,zz9 	BLANK WHEN ZERO. 
000152 	    02 DISPLAY-PRODUCT-PRICE  PIC z,zz9 	    BLANK WHEN ZERO.
000153 	    02 DISPLAY-PRODUCT-AMOUNT PIC zz9 	    BLANK WHEN ZERO.
000154********トータル売上を指示するために********* 	    
000155 01 DISPLAY-TOTAL-COST.
000156 		02 						  PIC X(27) 		VALUE SPACE.
000157 		02 		    			  PIC X(11) 		VALUE "TOTAL COST:".
000158 		02						  PIC X(1)			VALUE SPACE.	
000159 		02 DISPLAY-COST-ALL       PIC zzz,zzz,zz9   BLANK WHEN ZERO.
000160*******商品の数量を指示するために********** 
000161 01 DISPLAY-TOTALP.
000162 		02 			              PIC X(14) 		VALUE "PRODUCT TOTAL:".	
000163 		02 						  PIC X     		VALUE SPACE.
000164 		02 DISPLAY-COUNT-ALLP	  PIC z,zz9			BLANK WHEN ZERO.
000165**********正しい商品の数量を指示するために********** 		
000166 01 DISPLAY-TOTALN.
000167 		02 					      PIC X(15) VALUE "PRODUCT NORMAL:".
000168 		02 DISPLAY-COUNT-NORMALP  PIC z,zz9         BLANK WHEN ZERO.
000169*****商品のエラーの数量を指示するために**********
000170 01 DISPLAY-TOTALE.
000171 		02 					      PIC X(14) VALUE "PRODUCT ERROR:".
000172 		02                        PIC X				VALUE SPACE.
000173 		02 DISPLAY-COUNT-ERRORP  PIC z,zz9         BLANK WHEN ZERO.		
000174 						    						  		
000175 01 CHECK.
000176 		02 CHECK-EOF	  		  PIC X VALUE "F".	
000177 PROCEDURE DIVISION.
000178 MAIN-PROGRAM.
000179 		PERFORM SORT-FILE
000180 		PERFORM INIT-PROGRAM
000181 		PERFORM MAIN-PROCESS UNTIL CHECK-EOF = "T"
000182 		PERFORM WRITE-ENDP
000183		STOP RUN.
000184**********************		
000185 INIT-PROGRAM.
000186 		OPEN INPUT PRODUCTFILE
000194      OPEN OUTPUT WRITEFILE
000196	    WRITE WRITEP FROM DISPLAY-TITLEP AFTER 5 LINE.
000199      PERFORM PRODUCT-INPUT.
000209*******主要の処理のプログラム********	 
000210 MAIN-PROCESS.
000211      ADD 1 TO COUNT-ALL
000212      ADD 1 TO COUNT-RECORD
000213	    IF COUNT-ALL = 1 THEN
000214	       MOVE PRODUCT-ID(1:1) TO CHECK-GROUP	
000215	    END-IF 
000216	   
000217	    IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000218	       COMPUTE COST-PRODUCT = PRODUCT-AMOUNT * PRODUCT-PRICE
000219	       
000220	       IF CHECK-GROUP = PRODUCT-ID(1:1) THEN
000221	           COMPUTE COST-GROUP = COST-GROUP + COST-PRODUCT
000222	       ELSE	
000223	       	   PERFORM WRITE-GROUP-PRODUCT
000224	       	   COMPUTE COST-ALL = COST-GROUP + COST-ALL
000225	           MOVE PRODUCT-ID(1:1) TO CHECK-GROUP
000226	           MOVE COST-PRODUCT TO COST-GROUP
000227	       END-IF
000228	       MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000229    	   PERFORM WRITE-PRODUCT
000230    	   
000231	    ELSE
000232	   	   ADD 1 TO COUNT-ERROR
000233	   	   IF CHECK-GROUP NOT EQUAL PRODUCT-ID(1:1) THEN
000234	   	       PERFORM WRITE-GROUP-PRODUCT
000235	   	       COMPUTE COST-ALL = COST-GROUP + COST-ALL
000236	   	       MOVE PRODUCT-ID(1:1) TO CHECK-GROUP
000237	   	       MOVE 0 TO COST-GROUP
000238	   	       
000239	   	   END-IF
000240	       PERFORM WRITE-PRODUCT
000241	    END-IF	
000242     
000243      PERFORM PRODUCT-INPUT.
000249      
000252*****       PRODUCT-ID　のどおりPRODUCT　ファイルをソートします　********
000253 SORT-FILE.
000254 		SORT WORKFILE ON ASCENDING KEY WP-ID
000255   	USING SPFILE GIVING PRODUCTFILE.
000256****売上データの入力******* 
000257 PRODUCT-INPUT.
000258		 READ PRODUCTFILE
000259		         AT END 
000260		         	MOVE "T" TO CHECK-EOF
000261		         	PERFORM WRITE-GROUP-PRODUCT
000262            		COMPUTE COST-ALL = COST-ALL + COST-GROUP
000263		         NOT AT END MOVE "N" TO CHECK-EOF
000265		 END-READ.		
000266******グループのトータル売上を書きます***** 		  
000267 WRITE-GROUP-PRODUCT.
000268 		MOVE COST-GROUP TO DISPLAY-COST-GROUP
000269 	    WRITE WRITEP FROM DISPLAY-GROUP.     
000270******商品の詳細を書きます****** 	     
000271 WRITE-PRODUCT.
000272	   MOVE PRODUCT-ID     TO DISPLAY-PID
000273	   MOVE PRODUCT-NAME   TO DISPLAY-PNAME
000274	   IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000275	   		MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000276	        MOVE DISPLAY-PRODUCT-PRICE TO DISPLAY-PPRICE 
000277	        MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000278	        MOVE DISPLAY-PRODUCT-AMOUNT TO DISPLAY-PAMOUNT
000279 	   		MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000280 	   		MOVE DISPLAY-COST-PRODUCT TO DISPLAY-PCOST
000281	   ELSE
000282	       IF PRODUCT-PRICE IS NUMERIC THEN
000283	           MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000284	           MOVE DISPLAY-PRODUCT-PRICE TO DISPLAY-PPRICE
000285	       ELSE
000286	           MOVE "-----" TO DISPLAY-PPRICE 
000287	       END-IF
000288	       
000289	       IF PRODUCT-AMOUNT IS NUMERIC THEN
000290	           MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000291	           MOVE DISPLAY-PRODUCT-AMOUNT TO DISPLAY-PAMOUNT
000292	       ELSE
000293	           MOVE "---" TO DISPLAY-PAMOUNT
000294	       END-IF
000295	       
000296	       MOVE "  --------  " TO DISPLAY-PCOST
000297	   END-IF
000298	   IF COUNT-RECORD > 20 THEN
000299	       MOVE 0 TO COUNT-RECORD
000300	       MOVE SPACE TO WRITEP 
000301	       WRITE WRITEP AFTER PAGE
000302	       WRITE WRITEP FROM DISPLAY-TITLEP AFTER 4 LINE
000303	   END-IF.
000304	   WRITE WRITEP FROM DISPLAY-PRODUCT AFTER 2 LINE.
000305	    
000306********トータル売上を書きます*********	     
000307 WRITE-TOTAL-COSTP.
000308 	   MOVE COST-ALL TO DISPLAY-COST-ALL	    
000309 	   WRITE WRITEP FROM DISPLAY-TOTAL-COST. 
000310*********商品の数量を書きます************* 
000311 WRITE-TOTALP.
000312	   MOVE COUNT-ALL TO DISPLAY-COUNT-ALLP 
000313 	   WRITE WRITEP FROM DISPLAY-TOTALP.   
000314* ********商品のエラーの数量を書きます*********	    
000315 WRITE-TOTAL-ERRORP.
000316     MOVE COUNT-ERROR TO DISPLAY-COUNT-ERRORP	    
000317 	   WRITE WRITEP FROM DISPLAY-TOTALE.
000318*********正しい商品の数量を書きます************* 	   
000319 WRITE-TOTAL-NORMALP.
000320 	   COMPUTE COUNT-NORMAL = COUNT-ALL - COUNT-ERROR
000321     MOVE COUNT-NORMAL TO DISPLAY-COUNT-NORMALP   
000322 	   WRITE WRITEP FROM DISPLAY-TOTALN.	    
000323 	    
000324********************************* 	    	    
000325 WRITE-ENDP.
000326 	   PERFORM WRITE-TOTAL-COSTP
000327 	   PERFORM WRITE-TOTALP
000328 	   PERFORM WRITE-TOTAL-ERRORP
000329 	   PERFORM WRITE-TOTAL-NORMALP
000330 	   CLOSE WRITEFILE.
000331     CLOSE PRODUCTFILE.
000332 
000333 	   
000343 END PROGRAM Example1.