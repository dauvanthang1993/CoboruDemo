000010*>
000020 IDENTIFICATION DIVISION.
000030 PROGRAM-ID.   Example1.
000040 ENVIRONMENT    DIVISION.
000050 CONFIGURATION  SECTION.
000051 INPUT-OUTPUT SECTION.
000052 FILE-CONTROL.
000054 		SELECT PRODUCTFILE ASSIGN TO "INPUT.txt"
000056           ORGANIZATION IS LINE SEQUENTIAL.
000057      SELECT WRITEFILE ASSIGN TO PRINTER.
000059      SELECT SPFILE ASSIGN TO "PRODUCT.txt"
000060      	 ORGANIZATION IS LINE SEQUENTIAL.
000061      SELECT WORKFILE ASSIGN TO "SWAP.TMP".
000063                
000064 DATA DIVISION.
000065 FILE SECTION.
000066*******売上データファイル************ 
000067 FD PRODUCTFILE.
000068 01 PRODUCT.
000070		02  PRODUCT-ID       PIC X(4).
000071 		02  PRODUCT-NAME     PIC X(20).
000072 		02  PRODUCT-PRICE    PIC 9(4).
000073 		02  PRODUCT-AMOUNT   PIC 9(3).
000074* 		
000075******ソートファイルするために********
000076 FD SPFILE.
000077 01 S-PRODUCT.
000078		02  SP-ID     PIC X(4).
000079 		02  SP-NAME   PIC X(20).
000080 		02  SP-PRICE  PIC 9(4).
000081 		02  SP-AMOUNT PIC 9(3).	
000082 	
000083 SD WORKFILE.
000084 01 PRODUCT-W.
000086		02  WP-ID     PIC X(4).
000087 		02  WP-NAME	  PIC X(20).
000088 		02  WP-PRICE  PIC 9(4).
000089 		02  WP-AMOUNT PIC 9(3).	
000090* 			
000091****売上報告書出力ファイル******** 		
000092 FD WRITEFILE.		
000093 01 WRITEP.
000094 		02 	WRITE-STRING PIC X(71).	
000095* 		
000096 WORKING-STORAGE SECTION.
000097 01 COST.
000098 		02 COST-PRODUCT PIC 9(9)  VALUE ZERO.
000099 		02 COST-ALL     PIC 9(10) VALUE ZERO.
000100 		02 COST-GROUP   PIC 9(10) VALUE ZERO.
000101 01 COUNT-PRODUCT.
000102 		02 COUNT-ALL    PIC 9(3) VALUE ZERO.
000103 		02 COUNT-ERROR  PIC 9(3) VALUE ZERO.	
000104 		02 COUNT-NORMAL PIC 9(3).
000105 		02 COUNT-RECORD PIC 9(2) VALUE ZERO.
000106
000107* 01 DISPLAY-TITLE
000108 							
000109*********商品のタイトルを作ります************* 
000110 01 TITLEP.
000120 		02							   PIC X(5)  VALUE SPACE.	
000122 		02                             PIC X(2)  VALUE "ID".
000123 		02                             PIC X(4)  VALUE SPACE.
000124 		02                             PIC X(4)  VALUE "NAME".
000125 		02                             PIC X(18) VALUE SPACE.
000126 		02                             PIC X(5)  VALUE "PRICE".
000127 		02							   PIC X(3)  VALUE SPACE.	
000128 		02                             PIC X(6)  VALUE "AMOUNT".
000129 		02                             PIC X(1)  VALUE SPACE.
000130 		02                             PIC X(4)  VALUE "COST". 
000131* 
000132*****売上報告書のタイトル***********
000133 01 TITLE-SALEREPORT.
000134		02 							   PIC X(13).
000135		02                             PIC X(37)  VALUE "***********  SALE REPORT  ***********".
000136*********売上明細編集レコード*************  		   
000137 01 DISPLAY-PRODUCT.
000138 		02						  PIC X(5)  VALUE SPACE.
000139  	02 DISPLAY-PID			  PIC X(4).
000140  	02						  PIC X(2) VALUE SPACE.
000141  	02 DISPLAY-PNAME		  PIC X(20).
000142  	02						  PIC X(2) VALUE SPACE.
000143  	02 DISPLAY-PPRICE		  PIC X(5).
000144  	02 						  PIC X(3) VALUE SPACE.
000145  	02 DISPLAY-PAMOUNT		  PIC X(3).
000146  	02 						  PIC X(2) VALUE SPACE.
000147  	02 DISPLAY-PCOST          PIC X(9).	
000148*  			
000149********グループの商品を指示するために******** 
000150 01 DISPLAY-GROUP.
000151 		02						  PIC X(5)          VALUE SPACE.
000152 		02  					  PIC X(26) 		VALUE SPACE.
000153 		02 						  PIC X(11) 		VALUE "GROUP-COST:".
000154 		02 CHECK-GROUP			  PIC X.	
000155 		02                        PIC X(2)          VALUE SPACE.
000156 		02 DISPLAY-COST-GROUP     PIC zz,zzz,zz9	BLANK WHEN ZERO. 
000157* 		             			
000158 01 DISPLAY-VALUE.
000159 	    02 DISPLAY-COST-PRODUCT   PIC z,zzz,zz9 	BLANK WHEN ZERO. 
000160 	    02 DISPLAY-PRODUCT-PRICE  PIC z,zz9 	    BLANK WHEN ZERO.
000161 	    02 DISPLAY-PRODUCT-AMOUNT PIC zz9 	    BLANK WHEN ZERO.
000162********トータル売上を指示するために********* 	    
000163 01 DISPLAY-TOTAL-COST.
000164 		02                        PIC X             VALUE SPACE.
000165 		02 		    			  PIC X(11) 		VALUE "TOTAL COST:".
000166 		02						  PIC X(1)			VALUE SPACE.	
000167 		02 DISPLAY-COST-ALL       PIC zzz,zzz,zz9   BLANK WHEN ZERO.
000168* 		
000169*******商品の数量を指示するために********** 
000170 01 DISPLAY-TOTALP.
000171 		02                        PIC X             VALUE SPACE.
000172 		02 			              PIC X(14) 		VALUE "PRODUCT TOTAL:".	
000173 		02 						  PIC X     		VALUE SPACE.
000174 		02 DISPLAY-COUNT-ALLP	  PIC z,zz9			BLANK WHEN ZERO.
000175* 		
000176**********正しい商品の数量を指示するために********** 		
000177 01 DISPLAY-TOTALN.
000178 		02                        PIC X             VALUE SPACE.
000179 		02 					      PIC X(15) VALUE "PRODUCT NORMAL:".
000180 		02 DISPLAY-COUNT-NORMALP  PIC z,zz9         BLANK WHEN ZERO.
000181* 		
000182*****商品のエラーの数量を指示するために**********
000183 01 DISPLAY-TOTALE.
000184 		02                        PIC X             VALUE SPACE.
000185 		02 					      PIC X(14) VALUE "PRODUCT ERROR:".
000186 		02                        PIC X				VALUE SPACE.
000187 		02 DISPLAY-COUNT-ERRORP  PIC z,zz9         BLANK WHEN ZERO.		
000188* 						    						  		
000189 01 CHECK.
000190 		02 CHECK-EOF	  		  PIC X VALUE "F".	
000191 PROCEDURE DIVISION.
000192 MAIN-PROGRAM.
000193 		PERFORM SORT-FILE
000194 		PERFORM INIT-PROGRAM
000195 		PERFORM MAIN-PROCESS UNTIL CHECK-EOF = "T"
000196 		PERFORM WRITE-ENDP
000197		STOP RUN.
000198**********************		
000199 INIT-PROGRAM.
000200 		OPEN INPUT PRODUCTFILE
000201      OPEN OUTPUT WRITEFILE
000202      WRITE WRITEP FROM TITLE-SALEREPORT AFTER 5 LINE.
000203	    WRITE WRITEP FROM TITLEP AFTER 3 LINE.
000204      PERFORM PRODUCT-INPUT.
000205 END-INIT-PROGRAM.
000206*      
000209*******主要の処理のプログラム********	 
000210 MAIN-PROCESS.
000211      COMPUTE COUNT-ALL = COUNT-ALL + 1
000212      COMPUTE COUNT-RECORD = COUNT-RECORD + 1
000213	    IF COUNT-ALL = 1 THEN
000214	       MOVE PRODUCT-ID(1:1) TO CHECK-GROUP	
000215	    END-IF 
000216	   
000217	    IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000218	       COMPUTE COST-PRODUCT = PRODUCT-AMOUNT * PRODUCT-PRICE
000219	       
000220	       IF CHECK-GROUP = PRODUCT-ID(1:1) THEN
000221	           COMPUTE COST-GROUP = COST-GROUP + COST-PRODUCT
000222	       ELSE	
000223	       	   PERFORM WRITE-GROUP-PRODUCT
000224	       	   COMPUTE COST-ALL = COST-GROUP + COST-ALL
000225	           MOVE PRODUCT-ID(1:1) TO CHECK-GROUP
000226	           MOVE COST-PRODUCT TO COST-GROUP
000227	       END-IF
000228	       MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000229    	   PERFORM WRITE-PRODUCT
000230    	   
000231	    ELSE
000232	   	   COMPUTE COUNT-ERROR = COUNT-ERROR + 1
000233	   	   IF CHECK-GROUP NOT EQUAL PRODUCT-ID(1:1) THEN
000234	   	       PERFORM WRITE-GROUP-PRODUCT
000235	   	       COMPUTE COST-ALL = COST-GROUP + COST-ALL
000236	   	       MOVE PRODUCT-ID(1:1) TO CHECK-GROUP
000237	   	       MOVE 0 TO COST-GROUP
000238	   	       
000239	   	   END-IF
000240	       PERFORM WRITE-PRODUCT
000241	    END-IF	
000242     
000243      PERFORM PRODUCT-INPUT.
000249 END-MAIN-PROCESS.
000250*      
000252*****       PRODUCT-ID　のどおりPRODUCT　ファイルをソートします　********
000253 SORT-FILE.
000254 		SORT WORKFILE ON ASCENDING KEY WP-ID
000255   	USING SPFILE GIVING PRODUCTFILE.
000256 END-SORT-FILE.
000257*   	
000258****売上データの入力******* 
000259 PRODUCT-INPUT.
000260		 READ PRODUCTFILE
000261		         AT END 
000262		         	MOVE "T" TO CHECK-EOF
000263		         	PERFORM WRITE-GROUP-PRODUCT
000264            		COMPUTE COST-ALL = COST-ALL + COST-GROUP
000265		         NOT AT END MOVE "N" TO CHECK-EOF
000266		 END-READ.
000267 END-PRODUCT-INPUT.
000268* 		 		
000269******グループのトータル売上を書きます***** 		  
000270 WRITE-GROUP-PRODUCT.
000271 		MOVE COST-GROUP TO DISPLAY-COST-GROUP
000272 	    WRITE WRITEP FROM DISPLAY-GROUP AFTER 2 LINE.   
000273 END-WRITE-GROUP-PRODCUT.
000274* 	      
000275******商品の詳細を書きます****** 	     
000276 WRITE-PRODUCT.
000277	   MOVE PRODUCT-ID     TO DISPLAY-PID
000278	   MOVE PRODUCT-NAME   TO DISPLAY-PNAME
000279	   IF PRODUCT-PRICE IS NUMERIC AND PRODUCT-AMOUNT IS NUMERIC THEN
000280	   		MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000281	        MOVE DISPLAY-PRODUCT-PRICE TO DISPLAY-PPRICE 
000282	        MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000283	        MOVE DISPLAY-PRODUCT-AMOUNT TO DISPLAY-PAMOUNT
000284 	   		MOVE COST-PRODUCT TO DISPLAY-COST-PRODUCT
000285 	   		MOVE DISPLAY-COST-PRODUCT TO DISPLAY-PCOST
000286	   ELSE
000287	       IF PRODUCT-PRICE IS NUMERIC THEN
000288	           MOVE PRODUCT-PRICE TO DISPLAY-PRODUCT-PRICE
000289	           MOVE DISPLAY-PRODUCT-PRICE TO DISPLAY-PPRICE
000290	       ELSE
000291	           MOVE "-----" TO DISPLAY-PPRICE 
000292	       END-IF
000293	       
000294	       IF PRODUCT-AMOUNT IS NUMERIC THEN
000295	           MOVE PRODUCT-AMOUNT TO DISPLAY-PRODUCT-AMOUNT
000296	           MOVE DISPLAY-PRODUCT-AMOUNT TO DISPLAY-PAMOUNT
000297	       ELSE
000298	           MOVE "---" TO DISPLAY-PAMOUNT
000299	       END-IF
000300	       
000301	       MOVE "--------" TO DISPLAY-PCOST
000302	   END-IF
000305*****リコードの数量＞２０のとき新しいページを移動します*******************	   
000306	   IF COUNT-RECORD > 10 THEN
000307	       MOVE 0 TO COUNT-RECORD
000308	       MOVE SPACE TO WRITEP 
000309	       WRITE WRITEP AFTER PAGE
000310	       WRITE WRITEP FROM TITLEP AFTER 4 LINE
000311	   END-IF.
000312	   WRITE WRITEP FROM DISPLAY-PRODUCT AFTER 2 LINE.
000313 END-WRITE-PRODUCT.
000314*    
000315********トータル売上を書きます*********	     
000316 WRITE-TOTAL-COSTP.
000317 	   MOVE COST-ALL TO DISPLAY-COST-ALL	    
000318 	   WRITE WRITEP FROM DISPLAY-TOTAL-COST. 
000319 END-WRITE-TOTAL-COSTP.
000320* 	   
000321*********商品の数量を書きます************* 
000322 WRITE-TOTALP.
000323	   MOVE COUNT-ALL TO DISPLAY-COUNT-ALLP 
000324 	   WRITE WRITEP FROM DISPLAY-TOTALP.  
000325 END-WRITE-TOTALP.
000326* 	    
000327* ********商品のエラーの数量を書きます*********	    
000328 WRITE-TOTAL-ERRORP.
000329     MOVE COUNT-ERROR TO DISPLAY-COUNT-ERRORP	    
000330 	   WRITE WRITEP FROM DISPLAY-TOTALE.
000331 END-WRITE-TOTAL-ERRORP.
000332* 	   
000333*********正しい商品の数量を書きます************* 	   
000334 WRITE-TOTAL-NORMALP.
000335 	   COMPUTE COUNT-NORMAL = COUNT-ALL - COUNT-ERROR
000336     MOVE COUNT-NORMAL TO DISPLAY-COUNT-NORMALP   
000337 	   WRITE WRITEP FROM DISPLAY-TOTALN.	    
000338 END-WRITE-TOTAL-NORMALP.
000339* 	    
000340********************************* 	    	    
000341 WRITE-ENDP.
000342 	   PERFORM WRITE-TOTAL-COSTP
000343 	   PERFORM WRITE-TOTALP
000344 	   PERFORM WRITE-TOTAL-ERRORP
000345 	   PERFORM WRITE-TOTAL-NORMALP
000346 	   CLOSE WRITEFILE.
000347     CLOSE PRODUCTFILE.
000348 
000349 	   
000353 END PROGRAM Example1.